openapi: 3.0.3
components:
  schemas:
    CreateAppointmentRequest:
      type: object
      required:
        - insuredId
        - scheduleId
        - countryISO
      properties:
        insuredId:
          type: string
          pattern: ^\d{5}$
          description: 5-digit insured identification code (e.g., '01234')
          example: '12345'
        scheduleId:
          type: integer
          minimum: 1
          description: ID of the appointment slot
          example: 100
        countryISO:
          type: string
          enum:
            - PE
            - CL
          description: Country code - only PE (Peru) or CL (Chile) allowed
          example: PE
      example:
        insuredId: '12345'
        scheduleId: 100
        countryISO: PE
    CreateAppointmentResponse:
      type: object
      properties:
        appointmentId:
          type: string
          description: ULID generated for the new appointment
          example: 01J7N123ABCDEFGHIJKLMNPQRS
        insuredId:
          type: string
          pattern: ^\d{5}$
          description: 5-digit insured identification code
          example: '12345'
        scheduleId:
          type: integer
          description: Schedule slot ID
          example: 100
        countryISO:
          type: string
          enum:
            - PE
            - CL
          description: Country code
          example: PE
        status:
          type: string
          enum:
            - pending
          description: Initial status of the appointment
          example: pending
        createdAt:
          type: string
          format: date-time
          description: ISO timestamp when created
          example: '2024-09-11T10:30:00.000Z'
        updatedAt:
          type: string
          format: date-time
          description: ISO timestamp when last updated
          example: '2024-09-11T10:30:00.000Z'
        centerId:
          type: integer
          nullable: true
          description: Medical center ID (optional)
          example: 4
        specialtyId:
          type: integer
          nullable: true
          description: Medical specialty ID (optional)
          example: 3
        medicId:
          type: integer
          nullable: true
          description: Doctor ID (optional)
          example: 4
        slotDatetime:
          type: string
          format: date-time
          nullable: true
          description: Appointment slot datetime (optional)
          example: '2024-09-30T12:30:00.000Z'
      example:
        appointmentId: 01J7N123ABCDEFGHIJKLMNPQRS
        insuredId: '12345'
        scheduleId: 100
        countryISO: PE
        status: pending
        createdAt: '2024-09-11T10:30:00.000Z'
        updatedAt: '2024-09-11T10:30:00.000Z'
        centerId: 4
        specialtyId: 3
        medicId: 4
        slotDatetime: '2024-09-30T12:30:00.000Z'
    AppointmentListResponse:
      type: object
      required:
        - appointments
        - pagination
      properties:
        appointments:
          type: array
          description: Array of appointment objects
          items:
            type: object
            required:
              - appointmentId
              - scheduleId
              - countryISO
              - status
              - createdAt
              - updatedAt
            properties:
              appointmentId:
                type: string
                description: ULID of the appointment
                example: 01J7N123ABCDEFGHIJKLMNPQRS
              scheduleId:
                type: integer
                description: Schedule slot ID
                example: 100
              countryISO:
                type: string
                enum:
                  - PE
                  - CL
                description: Country code
                example: PE
              status:
                type: string
                enum:
                  - pending
                  - completed
                description: Appointment status
                example: pending
              createdAt:
                type: string
                format: date-time
                description: ISO timestamp when created
                example: '2024-09-11T10:30:00.000Z'
              updatedAt:
                type: string
                format: date-time
                description: ISO timestamp when last updated
                example: '2024-09-11T10:30:00.000Z'
              centerId:
                type: integer
                nullable: true
                description: Medical center ID
                example: 4
              specialtyId:
                type: integer
                nullable: true
                description: Medical specialty ID
                example: 3
              medicId:
                type: integer
                nullable: true
                description: Doctor ID
                example: 4
        pagination:
          type: object
          required:
            - total
            - limit
            - hasMore
          description: Pagination information
          properties:
            total:
              type: integer
              minimum: 0
              description: Total number of appointments
              example: 2
            limit:
              type: integer
              minimum: 1
              maximum: 100
              description: Items per page limit
              example: 50
            hasMore:
              type: boolean
              description: Whether there are more results
              example: false
            lastKey:
              type: string
              nullable: true
              description: Key for next page
              example: 01J7N456DEFGHIJKLMNPQRSTU
      example:
        appointments:
          - appointmentId: 01J7N123ABCDEFGHIJKLMNPQRS
            scheduleId: 100
            countryISO: PE
            status: pending
            createdAt: '2024-09-11T10:30:00.000Z'
            updatedAt: '2024-09-11T10:30:00.000Z'
            centerId: 4
            specialtyId: 3
            medicId: 4
          - appointmentId: 01J7N456DEFGHIJKLMNPQRSTU
            scheduleId: 250
            countryISO: PE
            status: completed
            createdAt: '2024-09-10T14:00:00.000Z'
            updatedAt: '2024-09-10T16:30:00.000Z'
            centerId: 4
            specialtyId: 2
            medicId: 7
        pagination:
          total: 2
          limit: 50
          hasMore: false
          lastKey: null
    ErrorResponse:
      type: object
      required:
        - error
        - message
        - timestamp
      properties:
        error:
          type: string
          description: Error type
          example: ValidationError
        message:
          type: string
          description: Human-readable error message
          example: 'Invalid input data: insuredId must be exactly 5 digits'
        timestamp:
          type: string
          format: date-time
          description: Error occurrence timestamp
          example: '2024-09-11T10:30:00.000Z'
        details:
          type: array
          description: Detailed validation errors (optional)
          items:
            type: object
            properties:
              field:
                type: string
                description: Field name with error
              message:
                type: string
                description: Field-specific error message
      example:
        error: ValidationError
        message: 'Invalid input data: insuredId must be exactly 5 digits'
        timestamp: '2024-09-11T10:30:00.000Z'
    NotFoundResponse:
      type: object
      required:
        - error
        - message
        - timestamp
      properties:
        error:
          type: string
          enum:
            - NotFound
          example: NotFound
        message:
          type: string
          example: 'No appointments found for insured ID: 12345'
        timestamp:
          type: string
          format: date-time
          example: '2024-09-11T10:30:00.000Z'
      example:
        error: NotFound
        message: 'No appointments found for insured ID: 12345'
        timestamp: '2024-09-11T10:30:00.000Z'
    Access-Control-Allow-Origin:
      type: string
      default: '*'
      example: https://developer.mozilla.org
    Access-Control-Allow-Credentials:
      type: boolean
      default: true
    insuredId:
      type: string
      pattern: ^\d{5}$
      example: '12345'
    status:
      type: string
      enum:
        - pending
        - completed
      example: pending
    limit:
      type: integer
      minimum: 1
      maximum: 100
      example: 25
    lastKey:
      type: string
      example: 01J7N456DEFGHIJKLMNPQRSTU
info:
  title: Medical Appointments API
  description: >-
    Serverless API for managing medical appointments in Peru and Chile. This API
    provides endpoints for creating appointments and retrieving appointment
    history for insured users.
  version: 1.0.0
  contact:
    name: API Support
    url: https://medical-appointments.com/support
    email: support@medical-appointments.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
paths:
  /appointments:
    post:
      summary: Create a new medical appointment
      description: >-
        Creates a new appointment for a patient in the specified country (PE or
        CL)
      operationId: appointment
      parameters: []
      tags:
        - appointments
      requestBody:
        description: Appointment creation data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAppointmentRequest'
      responses:
        '201':
          description: Appointment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateAppointmentResponse'
          headers:
            Access-Control-Allow-Origin:
              description: >-
                The Access-Control-Allow-Origin response header indicates
                whether the response can be shared with requesting code from the
                given
                [origin](https://developer.mozilla.org/en-US/docs/Glossary/Origin).
                - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Origin'
            Access-Control-Allow-Credentials:
              description: >-
                The Access-Control-Allow-Credentials response header tells
                browsers whether to expose the response to the frontend
                JavaScript code when the request's credentials mode
                ([Request.credentials](https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials))
                is include. - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Credentials'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
          headers:
            Access-Control-Allow-Origin:
              description: >-
                The Access-Control-Allow-Origin response header indicates
                whether the response can be shared with requesting code from the
                given
                [origin](https://developer.mozilla.org/en-US/docs/Glossary/Origin).
                - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Origin'
            Access-Control-Allow-Credentials:
              description: >-
                The Access-Control-Allow-Credentials response header tells
                browsers whether to expose the response to the frontend
                JavaScript code when the request's credentials mode
                ([Request.credentials](https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials))
                is include. - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Credentials'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
          headers:
            Access-Control-Allow-Origin:
              description: >-
                The Access-Control-Allow-Origin response header indicates
                whether the response can be shared with requesting code from the
                given
                [origin](https://developer.mozilla.org/en-US/docs/Glossary/Origin).
                - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Origin'
            Access-Control-Allow-Credentials:
              description: >-
                The Access-Control-Allow-Credentials response header tells
                browsers whether to expose the response to the frontend
                JavaScript code when the request's credentials mode
                ([Request.credentials](https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials))
                is include. - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Credentials'
  /appointments/{insuredId}:
    get:
      summary: Get appointments for an insured person
      description: >-
        Retrieves all appointments for a specific insured person with optional
        filtering and pagination
      operationId: getAppointments
      parameters:
        - name: insuredId
          in: path
          description: 5-digit insured identification code
          required: true
          schema:
            $ref: '#/components/schemas/insuredId'
        - name: status
          in: query
          description: Filter appointments by status
          required: false
          schema:
            $ref: '#/components/schemas/status'
        - name: limit
          in: query
          description: 'Maximum number of appointments to return (default: 50, max: 100)'
          required: false
          schema:
            $ref: '#/components/schemas/limit'
        - name: lastKey
          in: query
          description: Pagination key for next page of results
          required: false
          schema:
            $ref: '#/components/schemas/lastKey'
      tags:
        - appointments
      responses:
        '200':
          description: Appointments retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentListResponse'
          headers:
            Access-Control-Allow-Origin:
              description: >-
                The Access-Control-Allow-Origin response header indicates
                whether the response can be shared with requesting code from the
                given
                [origin](https://developer.mozilla.org/en-US/docs/Glossary/Origin).
                - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Origin'
            Access-Control-Allow-Credentials:
              description: >-
                The Access-Control-Allow-Credentials response header tells
                browsers whether to expose the response to the frontend
                JavaScript code when the request's credentials mode
                ([Request.credentials](https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials))
                is include. - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Credentials'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
          headers:
            Access-Control-Allow-Origin:
              description: >-
                The Access-Control-Allow-Origin response header indicates
                whether the response can be shared with requesting code from the
                given
                [origin](https://developer.mozilla.org/en-US/docs/Glossary/Origin).
                - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Origin'
            Access-Control-Allow-Credentials:
              description: >-
                The Access-Control-Allow-Credentials response header tells
                browsers whether to expose the response to the frontend
                JavaScript code when the request's credentials mode
                ([Request.credentials](https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials))
                is include. - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Credentials'
        '404':
          description: No appointments found for the insured person
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundResponse'
          headers:
            Access-Control-Allow-Origin:
              description: >-
                The Access-Control-Allow-Origin response header indicates
                whether the response can be shared with requesting code from the
                given
                [origin](https://developer.mozilla.org/en-US/docs/Glossary/Origin).
                - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Origin'
            Access-Control-Allow-Credentials:
              description: >-
                The Access-Control-Allow-Credentials response header tells
                browsers whether to expose the response to the frontend
                JavaScript code when the request's credentials mode
                ([Request.credentials](https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials))
                is include. - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Credentials'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
          headers:
            Access-Control-Allow-Origin:
              description: >-
                The Access-Control-Allow-Origin response header indicates
                whether the response can be shared with requesting code from the
                given
                [origin](https://developer.mozilla.org/en-US/docs/Glossary/Origin).
                - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Origin'
            Access-Control-Allow-Credentials:
              description: >-
                The Access-Control-Allow-Credentials response header tells
                browsers whether to expose the response to the frontend
                JavaScript code when the request's credentials mode
                ([Request.credentials](https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials))
                is include. - [MDN
                Link](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)
              schema:
                $ref: '#/components/schemas/Access-Control-Allow-Credentials'
servers:
  - url: https://api.medical-appointments.com
    description: Production server
  - url: https://dev-api.medical-appointments.com
    description: Development server
  - url: http://localhost:3000/dev
    description: Local development server
tags:
  - name: appointments
    description: Appointment management operations
    externalDocs:
      description: Learn more about appointment workflow
      url: https://docs.medical-appointments.com/appointments
externalDocs:
  description: Find more info about the Medical Appointments system
  url: https://docs.medical-appointments.com
